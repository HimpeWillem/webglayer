
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>MOV - moving object visualisation</title>
<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
<style>
#canvasContainer {
	position: relative;
	border: 1px;
	padding: 0;
	height: 400px;
	width: 800px;
}
</style>

<script src="../javascripts/jquery-1.9.1.min.js"></script>
<script src="js/Dimension.js"></script>
<script src="js/Manager.js"></script>
<script src="js/OneDDimension.js"></script>
<script src="js/MapDimension.js"></script>
<script src="js/FilterUtility.js"></script>
<!-- <script src="js/Charts.js"></script> -->



<script>
	document.addEventListener('DOMContentLoaded', init, false);		
	function init() {
		/*bind the shader to DOM*/
		getShader();
		
		r_count =3 * Math.pow(10,2);
		var manager = new Manager("test");	
		
		/**init geo buffer*/
		manager.addData(generateData(r_count, 2, 2),2, 'wPoint');
		/*init first attribute buffer*/
		manager.addData(generatePositiveData(r_count, 1, 3),1, 'speed');	
		

		/*setup map*/
		var dimMap = new MapDimension(manager);
		dimMap.name = "map";	
		dimMap.setProgram('map_vShader', 'map_fShader');
	
		
		
		
		/*Setup histogram*/
		var dimSpeed = new OneDDimension(manager);
		dimSpeed.name = "speed";
		dimSpeed.setProgram('speed_vShader', 'speed_fShader');
		dimSpeed.bin_count = 5;
		dimSpeed.max = 200		
		
		/*Setup time*/
		/*var dimTime = new OneDDimension(manager);
		dimTime.name = "time";
		dimTime.setProgram('speed_vShader', 'speed_fShader');
		dimTime.bin_count = 3;
		dimTime.max = 100*/
		
		/*Setup map filter*/
		
		var util = new FilterUtility(manager);
		util.setProgram();
		
	
		/*Render*/
				
		
		manager.render();		
		console.timeEnd("drawing")
	
		util.setup();		
		util.renderFilter(generatePolygon(2,18));
		
		//dimSpeed.readFloatPixels();
		//dimTime.readFloatPixels();
	}
	
	
	/* generate data */
	generateData = function(imax, dim, size) {
		atr = new Float32Array(imax*dim);
		for (var i = 0; i < (imax*dim); i++) {
			atr[i] = Math.random() * size - (size/2);
		}
		return atr;
	}
	
	generatePolygon = function(imax, size) {
		atr = new Float32Array(imax*size);
		for (var i = 0; i < (imax*size); i++) {
			atr[i] = Math.random() * size - (size/2);
		}
		return atr;
	}
	
	
	generatePositiveData = function(count, dim, maxvalue) {
		atr = new Float32Array(count*dim);
		for (var i = 0; i < (count*dim); i++) {
		  //atr[i] = (Math.random() * maxvalue)+0.5;	
		  atr[i] = 100;
		}
		return atr;
	}
	
	getShader = function() {
		$.ajaxSetup({
			async : false
		});

		$.get('shaders/map_shaders.txt', function(data) {
			$("head").append(data);
		});

		
		$.get('shaders/speed_vShader.txt', function(data) {
			$("head").append(data);
		});

		$.get('shaders/speed_fShader.txt', function(data) {
			$("head").append(data);
		});
		
		$.get('shaders/mapFilter_shaders.txt', function(data) {
			$("head").append(data);
		});
		
		$.ajaxSetup({
			async : true
		});
	}
</script>
</head>
<body>
	<div id="canvasContainer">
		<canvas id="test">Your browser does not support HTML5</canvas>
	</div>
	<div class='chart_1'>Chart 1</div>
	

</body>
</html>